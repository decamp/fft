/*
 * Copyright (c) 2014, Massachusetts Institute of Technology
 * Released under the BSD 2-Clause License
 * http://opensource.org/licenses/BSD-2-Clause
 */
package bits.fft;

import org.junit.Test;
import java.util.Random;

public class FastCosineTransform2dTest {

    private static final int OFF_0 = 3;
    private static final int DIM_0 = 8;
    
    private static final double[] INPUT_0 = { 
        0.0,
        0.0,
        0.0,
        0.46193557475331404,
        -0.5189271686570283,
        0.2748348507002165,
        0.10087401023526787,
        0.19509055559440358,
        -0.33356320104670045,
        -0.229621630518563,
        0.9696830803996179,
        0.7583650357449603,
        0.8824983589642288,
        -0.45009206792903034,
        -0.7422056982524465,
        -0.7067966847069636,
        -0.9535237550322211,
        0.09347951439693114,
        0.9289737213537002,
        -0.7910186274980566,
        0.2502927269311186,
        -0.17840760901787656,
        0.552624582549865,
        0.981445571429566,
        -0.025534305939714397,
        0.49248281064466104,
        0.4663041403899877,
        0.6345941428186488,
        0.6777807000940366,
        0.05339886920973225,
        0.7986700232229871,
        -0.7321203188262155,
        -0.8338752035501702,
        0.9571486802956806,
        0.4447142383776974,
        0.4300620277009488,
        -0.7135592293988064,
        -0.07408436315515421,
        -0.9910287956342296,
        -0.8570033702402118,
        -0.3031595404166709,
        -0.3224606929284928,
        0.7187131027092959,
        0.9430939777034255,
        0.7314917604280766,
        0.2251622094197363,
        -0.6420240309423655,
        -0.564859175580628,
        0.7089743340845813,
        -0.9806530053980513,
        0.38458601390586655,
        0.5426259323413591,
        0.4253748562913786,
        -0.5775292501402076,
        0.5661849795343588,
        0.8906664779192579,
        -0.9715272897926641,
        -0.2115928944453378,
        0.7075815506161456,
        0.5720849016291052,
        0.986943910011628,
        0.766208811962958,
        -0.6594169395045921,
        0.9241378364150772,
        0.44859006715773764,
        0.35470832249974893,
        0.6087908344492714
    };
    
    private static final double[] OUTPUT_0 = { 
        8.54658824633418,
        3.0919506879252605,
        21.76501026701205,
        -7.03526047417121,
        10.244660760750847,
        -7.910727890738463,
        -2.0239869216161863,
        2.571196976116896,
        -5.98913945184423,
        -8.588221662145198,
        2.905482234771693,
        -9.928705173857145,
        3.880151601757354,
        10.777705276988886,
        -5.2689888891065975,
        -1.8781048329525671,
        8.252976164588302,
        0.728783846124214,
        -4.211917477844538,
        2.950199355624929,
        6.0749692738643475,
        -13.153480021502912,
        0.2783682971246506,
        10.035998404837187,
        -10.934195496283113,
        7.358782629046263,
        11.225697161953438,
        3.4193646373444837,
        7.675799490137521,
        -0.019569405173554877,
        24.550152946429034,
        -5.39946093038888,
        1.5184409978153424,
        -3.3733709556809774,
        3.4819213229227572,
        -3.1628103688468405,
        -4.770467302404379,
        11.915405662159106,
        9.745538201967214,
        7.848634229049331,
        6.845034937233318,
        -1.0603237893912447,
        -18.00155043085472,
        -6.7113426585530425,
        14.78258108200004,
        9.957081494244502,
        -15.738994668049266,
        -3.1359052518929857,
        6.387450106557392,
        -4.895875270246665,
        -18.015693302596468,
        6.743053950597888,
        -11.572429322329617,
        -8.33054059125719,
        13.89693943564108,
        -1.1578280932077263,
        -5.968277815777793,
        -16.99356805336541,
        -15.686314058486573,
        0.14083679837070862,
        11.393317180463137,
        -3.01686607786617,
        1.0621389224734894,
        8.625888410830985
    };

    
    @Test
    public void testCorrect() {
        final int dim = DIM_0;
        final int off = OFF_0;
        final int len = dim * dim;
        
        final double[] b = new double[len+off];
        final double[] c = new double[len+off];
        
        
        FastCosineTransform2d trans = new FastCosineTransform2d( dim );
        
        trans.apply(INPUT_0, off, false, b, off);
        trans.apply(b, off, true, c, off);
            
        //System.out.println(TestUtil.realToMatlab(INPUT_0, off, dim, dim));
        //System.out.println("===");
        //System.out.println(TestUtil.formatReal(c, off, dim, dim));
        //System.out.println(TestUtil.arrayToJava(b, off, len, "OUTPUT_0"));
        
        TestUtil.assertNear(OUTPUT_0, 0, b, off, len);
        TestUtil.assertNear(INPUT_0, off, c, off, len);
    }
    
    
    @Test
    public void testSpeed() {
        final int dim = 512;
        final double[] v = new double[dim*dim];
        
        Random rand = new Random(0);
        
        for(int i = 0; i < v.length; i++) {
            v[i] = rand.nextDouble() * 2.0 - 1.0;
        }
        
        double[] w = new double[dim*dim];
        FastCosineTransform2d trans = new FastCosineTransform2d( dim );

        long t0 = System.nanoTime();

        for(int i = 0; i < 5; i++) {
            trans.apply(v, 0, false, w, 0);
        }

        double secs = ( System.nanoTime() - t0 ) / 1000000000.0;
        System.out.println( "FastCosineTransform2d seconds: " + secs );
    }

}